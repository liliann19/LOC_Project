<!-- index.ejs

    Division management page: lets users select a division, edit its leadership details,
    and view recent activity, using dynamic data loaded from the server. -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Division Management</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/gator-icon.png">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="/styles/styles.css">

    <!-- JavaScript -->
    <script src="js/LOC_Project.js" defer></script>
</head>

<body>
    <main>
        <h1>Division Management</h1>

        <!-- Navigation link back to dashboard -->
        <div class="summaryPage">
            <a href="/">â¬…Back to Dashboard</a>
        </div>

        <!-- Form for editing division information -->
        <form id="edit-form" action="/submit-report" method="post">

            <!-- Hidden ID -->
            <input type="hidden" name="id" id="divisionId" value="<%= data?.id || '' %>">

            <!-- Division Dropdown -->
            <label for="divDropdown">Select Division</label>
            <select id="divDropdown" name="divisionKey">
                <option value="">Select a Division</option>
                <% const uniqueDivisions={}; data.forEach(row=> {
                    if (!uniqueDivisions[row.divisionKey]) {
                    uniqueDivisions[row.divisionKey] = row.divName;
                    }
                    });

                    Object.keys(uniqueDivisions).forEach(key => {
                    %>
                    <option value="<%= key %>">
                        <%= uniqueDivisions[key] %>
                    </option>
                    <% }) %>
            </select>

            <%# Editable division info fields %>
                <fieldset id="editInfo" style="display:none;">
                    <label>Division:</label>
                    <input id="divName" type="text" name="divName" value="" readonly>
                    <span id="err-divName" class="errors"> Fill missing field or put TBD </span>

                    <label>Dean:</label>
                    <input id="dean" type="text" name="dean" value="">
                    <span id="err-dean" class="errors"> Fill missing field or put TBD </span>

                    <label>PEN Contact:</label>
                    <input id="penContact" type="text" name="penContact" value="">
                    <span id="err-penContact" class="errors"> Fill missing field or put TBD </span>

                    <label>LOC Rep:</label>
                    <input id="locRep" type="text" name="locRep" value="">
                    <span id="err-locRep" class="errors"> Fill missing field or put TBD</span>

                    <label>Chair:</label>
                    <input id="chair" type="text" name="chair" value="">
                    <span id="err-chair" class="errors"> Fill missing field or put TBD </span>
                </fieldset>

                <%# Buttons for save/cancel %>
                    <div id="buttonsContainer" style="display:none;">
                        <button type="submit" id="save-button">Save</button>
                        <button type="reset" id="cancel-button">Cancel</button>
                    </div>
        </form>

        <%# Panel for showing recent user changes %>
            <aside class="activity-panel">
                <h2>Recent Changes</h2>
                <ul>
                    <% recentChanges.forEach(change=> { %>
                        <li>
                            <strong>
                                <%= change.divName %>
                            </strong> - <%= change.academicProgram %> (<%= change.timestamp %>)
                        </li>
                        <% }) %>
                </ul>
            </aside>
    </main>

    <%# Popup notification %>
        <div id="popup" class="popup hidden">
            <p id="popupMessage"></p>
        </div>
        
</body>
</html>