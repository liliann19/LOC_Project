<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Division Management</title>
    <link rel="icon" type="image/png" href="/images/gator-icon.png">
    <link rel="stylesheet" href="/styles/styles.css">
    <script src="js/LOC_Project.js" defer></script>
</head>
<body>
    <main>
        <h1>Division Management</h1>

        <div class="summaryPage">
            <a href="/">Back to Dashboard</a>
        </div>

        <form id="edit-form" action="/submit-report" method="post">
            <!-- Hidden ID -->
            <input type="hidden" name="id" id="divisionId" value="<%= data?.id || '' %>">

            <!-- Dropdown -->
            <label for="divDropdown">Select Division</label>
            <select id="divDropdown" name="divisionKey">
                <option value="">Select a Division</option>
                <% 
                    const uniqueDivisions = {};
                    data.forEach(row => {
                        if (!uniqueDivisions[row.divisionKey]) {
                            uniqueDivisions[row.divisionKey] = row.divName;
                        }
                    });

                    Object.keys(uniqueDivisions).forEach(key => { 
                %>
                    <option value="<%= key %>"><%= uniqueDivisions[key] %></option>
                <% }) %>
            </select>

        
            <fieldset id="editInfo" style="display:none;">
                <label>Division:</label>
                <input id="divName" type="text" name="divName" value="" readonly>
                
                <label>Dean:</label>
                <input id="dean" type="text" name="dean" value="">
                
                <label>PEN Contact:</label>
                <input id="penContact" type="text" name="penContact" value="">
                
                <label>LOC Rep:</label>
                <input id="locRep" type="text" name="locRep" value="">
                
                <label>Chair:</label>
                <input id="chair" type="text" name="chair" value="">
            </fieldset>

            <div id="buttonsContainer" style="display:none;">
                <button type="submit" id="save-button">Save</button>
                <button type="reset" id="cancel-button">Cancel</button>
            </div>
        </form>

        
        <aside class="activity-panel">
            <h2>Recent Changes</h2>
            <ul>
                <% recentChanges.forEach(change => { %>
                    <li>
                        <strong><%= change.divName %></strong> - <%= change.academicProgram %> (<%= change.timestamp %>)
                    </li>
                <% }) %>
            </ul>
        </aside>
    </main>
    
    <div id="popup" class="popup hidden">
    <p id="popupMessage"></p>
    </div>

    <script>
  const params = new URLSearchParams(window.location.search);

  if (params.get('success') === 'divisionSaved') {
      showPopup("Division saved successfully!");
  }
</script>

</body>
</html>
